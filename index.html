<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VersÃ£o 4.0. - Treina-DEV | Route </title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            brand: {
              black: '#0a0a0a',
              purple: '#8b5cf6',
              purpleDark: '#6d28d9',
              gray: '#1f1f1f'
            }
          }
        }
      }
    }
  </script>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <style>
    /* Custom Scrollbar */
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: #0a0a0a; }
    ::-webkit-scrollbar-thumb { background: #8b5cf6; border-radius: 10px; }
    
    /* Efeito de brilho no mapa */
    #map { filter: grayscale(1) invert(1) contrast(0.9); }
    .leaflet-container { background: #0a0a0a !important; }
  </style>
</head>

<body class="bg-brand-black text-gray-100 min-h-screen font-sans selection:bg-brand-purple">

  <main class="w-full max-w-md mx-auto p-6 flex flex-col gap-6 md:max-w-4xl md:py-12">
    
    <header class="text-center space-y-2">
      <h1 class="text-3xl font-extrabold tracking-tight text-transparent bg-clip-text bg-gradient-to-r from-white to-brand-purple">
        Treina-DEV House Route Tracker
      </h1>
      <h3 class="text-center space-y-2">Rastreamento de Rota em Tempo Real</h3>
      <p class="text-gray-400 text-sm">Destino: CEP 74961-070</p>
    </header>

    <div class="flex flex-col gap-3">
  <button id="btn" class="w-full py-4 bg-brand-purple hover:bg-brand-purpleDark text-white font-bold rounded-2xl transition-all shadow-[0_0_15px_rgba(139,92,246,0.2)]">
    ğŸ“ Calcular Rota
  </button>
  
  <button id="openModal" class="w-full py-3 border-2 border-brand-purple text-brand-purple hover:bg-brand-purple/10 font-bold rounded-2xl transition-all">
    ğŸ¢ Cadastrar Estabelecimento
  </button>
</div>

<div id="modal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-[9999] hidden flex items-center justify-center p-4">
  <div class="bg-brand-gray border border-white/10 w-full max-w-sm rounded-3xl p-6 space-y-4 shadow-2xl">
    <h3 class="text-xl font-bold text-brand-purple">Novo Cadastro</h3>
    
    <div class="space-y-3">
      <input type="text" id="regName" placeholder="Nome Completo" class="w-full bg-black/50 border border-white/10 rounded-xl p-3 outline-none focus:border-brand-purple transition-all">
      <input type="text" id="regEst" placeholder="Nome do Estabelecimento" class="w-full bg-black/50 border border-white/10 rounded-xl p-3 outline-none focus:border-brand-purple transition-all">
      <input type="text" id="regTel" placeholder="Telefone (00) 00000-0000" maxlength="15" class="w-full bg-black/50 border border-white/10 rounded-xl p-3 outline-none focus:border-brand-purple transition-all">
      
      <div class="flex gap-2 text-xs text-gray-400 bg-black/30 p-2 rounded-lg">
        <span>ğŸ“ Coordenadas:</span>
        <span id="coordsDisplay">Aguardando GPS...</span>
      </div>
    </div>

    <div class="flex gap-2 pt-2">
      <button id="closeModal" class="flex-1 py-2 text-gray-400 font-medium">Cancelar</button>
      <button id="saveData" class="flex-1 py-2 bg-brand-purple rounded-xl font-bold">Salvar</button>
    </div>
  </div>
</div>

<div id="tempView" class="hidden space-y-3">
    <h4 class="text-xs uppercase tracking-widest text-gray-500 font-bold">Cadastrado TemporÃ¡rio</h4>
    <div class="bg-gradient-to-br from-brand-purple/20 to-transparent border border-brand-purple/30 p-4 rounded-2xl">
        <p id="viewText" class="text-sm leading-relaxed"></p>
    </div>
</div>

<script>
  const modal = document.getElementById("modal");
const openModalBtn = document.getElementById("openModal");
const closeModalBtn = document.getElementById("closeModal");
const regTel = document.getElementById("regTel");
const saveData = document.getElementById("saveData");
const tempView = document.getElementById("tempView");
const viewText = document.getElementById("viewText");
const coordsDisplay = document.getElementById("coordsDisplay");

let currentCoords = { lat: null, lng: null };

// MÃ¡scara de Telefone (00) 00000-0000
regTel.addEventListener("input", (e) => {
  let x = e.target.value.replace(/\D/g, '').match(/(\d{0,2})(\d{0,5})(\d{0,4})/);
  e.target.value = !x[2] ? x[1] : '(' + x[1] + ') ' + x[2] + (x[3] ? '-' + x[3] : '');
});

// Abrir Modal e pegar Coordenadas
openModalBtn.addEventListener("click", () => {
  modal.classList.remove("hidden");
  navigator.geolocation.getCurrentPosition((pos) => {
    currentCoords.lat = pos.coords.latitude.toFixed(6);
    currentCoords.lng = pos.coords.longitude.toFixed(6);
    coordsDisplay.textContent = `${currentCoords.lat}, ${currentCoords.lng}`;
  });
});

// Fechar Modal
closeModalBtn.addEventListener("click", () => modal.classList.add("hidden"));

// Salvar TemporÃ¡rio
saveData.addEventListener("click", () => {
  const nome = document.getElementById("regName").value;
  const est = document.getElementById("regEst").value;
  const tel = regTel.value;

  if(!nome || !est || tel.length < 14) {
    alert("Preencha todos os campos corretamente!");
    return;
  }

  // Exibe na tela de forma "bonita"
  tempView.classList.remove("hidden");
  viewText.innerHTML = `
    <strong>Estabelecimento:</strong> ${est}<br>
    <strong>ResponsÃ¡vel:</strong> ${nome}<br>
    <strong>Contato:</strong> ${tel}<br>
    <strong>Local:</strong> ${currentCoords.lat}, ${currentCoords.lng}
  `;

  modal.classList.add("hidden");
  
  // Dica: Aqui vocÃª usaria o fetch para o seu NestJS no futuro
  console.log("Pronto para o banco:", { nome, est, tel, ...currentCoords });
});
</script>

    <section class="bg-brand-gray/50 backdrop-blur-md border border-white/10 p-6 rounded-3xl shadow-2xl space-y-6">
      
      <button
        id="btn"
        class="w-full py-4 bg-brand-purple hover:bg-brand-purpleDark text-white font-bold rounded-2xl transition-all duration-300 transform active:scale-95 shadow-[0_0_20px_rgba(139,92,246,0.3)] flex items-center justify-center gap-2"
      >
        <span>ğŸ“</span> Calcular Rota Agora
      </button>

      <p id="info" class="text-center text-xs font-medium text-brand-purple animate-pulse"></p>

      <div class="relative group">
        <div class="absolute -inset-1 bg-gradient-to-r from-brand-purple to-purple-900 rounded-2xl blur opacity-25 group-hover:opacity-50 transition duration-1000"></div>
        <div id="map" class="relative w-full h-[300px] md:h-[450px] rounded-2xl border border-white/5 overflow-hidden"></div>
      </div>

    </section>

    <section id="results" class="grid grid-cols-1 md:grid-cols-3 gap-4 opacity-0 transition-opacity duration-500">
      <div class="bg-brand-gray/40 border border-white/5 p-4 rounded-2xl flex flex-col items-center">
        <span class="text-2xl mb-1">ğŸ“</span>
        <span class="text-gray-400 text-xs uppercase tracking-widest">DistÃ¢ncia</span>
        <p id="distance" class="text-lg font-bold text-white"></p>
      </div>
      
      <div class="bg-brand-gray/40 border border-white/5 p-4 rounded-2xl flex flex-col items-center">
        <span class="text-2xl mb-1">ğŸš—</span>
        <span class="text-gray-400 text-xs uppercase tracking-widest">Tempo Carro</span>
        <p id="carTime" class="text-lg font-bold text-white"></p>
      </div>

      <div class="bg-brand-gray/40 border border-white/5 p-4 rounded-2xl flex flex-col items-center">
        <span class="text-2xl mb-1">ğŸï¸</span>
        <span class="text-gray-400 text-xs uppercase tracking-widest">Tempo Moto</span>
        <p id="bikeTime" class="text-lg font-bold text-white"></p>
      </div>
    </section>

  </main>

<script>
  const btn = document.getElementById("btn")
  const info = document.getElementById("info")
  const results = document.getElementById("results")
  const distanceEl = document.getElementById("distance")
  const carTimeEl = document.getElementById("carTime")
  const bikeTimeEl = document.getElementById("bikeTime")

  const targetLat = -16.8236
  const targetLng = -49.2469

  let map
  let routeLayer

  btn.addEventListener("click", () => {
    info.textContent = "Acessando GPS..."

    navigator.geolocation.getCurrentPosition(async (pos) => {
      const userLat = pos.coords.latitude
      const userLng = pos.coords.longitude

      info.textContent = "TraÃ§ando melhor caminho..."

      if (!map) {
        map = L.map("map", { zoomControl: false }).setView([userLat, userLng], 13)
        L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map)
      }

      if (routeLayer) map.removeLayer(routeLayer)

      const url = `https://router.project-osrm.org/route/v1/driving/${userLng},${userLat};${targetLng},${targetLat}?overview=full&geometries=geojson`.replace(/\s+/g, "")

      try {
        const res = await fetch(url)
        const data = await res.json()
        const route = data.routes[0]

        const distanceKm = (route.distance / 1000).toFixed(1)
        const carMinutes = Math.round(route.duration / 60)
        const bikeMinutes = Math.round(carMinutes * 0.85)

        routeLayer = L.geoJSON(route.geometry, {
          style: { color: '#8b5cf6', weight: 5, opacity: 0.8 }
        }).addTo(map)

        // Ãcones customizados (Emoji como marcador simples)
        const userIcon = L.divIcon({ html: 'ğŸ”µ', className: 'text-xl', iconSize: [20, 20] })
        const destIcon = L.divIcon({ html: 'ğŸ', className: 'text-xl', iconSize: [20, 20] })

        L.marker([userLat, userLng], { icon: userIcon }).addTo(map)
        L.marker([targetLat, targetLng], { icon: destIcon }).addTo(map)

        map.fitBounds(routeLayer.getBounds(), { padding: [30, 30] })

        // Exibir resultados com animaÃ§Ã£o
        results.classList.remove('opacity-0')
        distanceEl.textContent = `${distanceKm} km`
        carTimeEl.textContent = `${carMinutes} min`
        bikeTimeEl.textContent = `${bikeMinutes} min`

        info.textContent = "Rota calculada com sucesso!"
        setTimeout(() => info.textContent = "", 3000)
      } catch (err) {
        info.textContent = "Erro ao calcular rota."
      }
    }, 
    () => info.textContent = "ğŸ“ Ative o GPS para continuar.")
  })
</script>

</body>
</html>
